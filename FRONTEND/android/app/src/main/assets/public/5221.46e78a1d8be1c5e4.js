"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5221],{5221:(P,h,s)=>{s.r(h),s.d(h,{EditarEventoComponent:()=>R});var g=s(467),d=s(9417),r=s(3092),E=s(8434),t=s(1360),C=s(9484),m=s(333);function x(e,p){1&e&&(t.j41(0,"ion-text",6),t.EFF(1," El t\xedtulo es obligatorio "),t.k0s())}function O(e,p){if(1&e&&(t.j41(0,"div",22),t.DNE(1,x,2,0,"ion-text",23),t.k0s()),2&e){let i;const o=t.XpG();t.R7$(),t.Y8G("ngIf",null==(i=o.eventoForm.get("titulo"))||null==i.errors?null:i.errors.required)}}function a(e,p){1&e&&(t.j41(0,"ion-text",6),t.EFF(1," La descripci\xf3n es obligatoria "),t.k0s())}function c(e,p){if(1&e&&(t.j41(0,"div",22),t.DNE(1,a,2,0,"ion-text",23),t.k0s()),2&e){let i;const o=t.XpG();t.R7$(),t.Y8G("ngIf",null==(i=o.eventoForm.get("descripcion"))||null==i.errors?null:i.errors.required)}}function F(e,p){1&e&&(t.j41(0,"ion-text",6),t.EFF(1," La fecha es obligatoria "),t.k0s())}function M(e,p){if(1&e&&(t.j41(0,"div",22),t.DNE(1,F,2,0,"ion-text",23),t.k0s()),2&e){let i;const o=t.XpG();t.R7$(),t.Y8G("ngIf",null==(i=o.eventoForm.get("fechaEvento"))||null==i.errors?null:i.errors.required)}}function k(e,p){1&e&&(t.j41(0,"ion-text",6),t.EFF(1," La hora es obligatoria "),t.k0s())}function D(e,p){if(1&e&&(t.j41(0,"div",22),t.DNE(1,k,2,0,"ion-text",23),t.k0s()),2&e){let i;const o=t.XpG();t.R7$(),t.Y8G("ngIf",null==(i=o.eventoForm.get("horaEvento"))||null==i.errors?null:i.errors.required)}}function I(e,p){1&e&&(t.j41(0,"ion-text",6),t.EFF(1," El lugar es obligatorio "),t.k0s())}function T(e,p){if(1&e&&(t.j41(0,"div",22),t.DNE(1,I,2,0,"ion-text",23),t.k0s()),2&e){let i;const o=t.XpG();t.R7$(),t.Y8G("ngIf",null==(i=o.eventoForm.get("lugar"))||null==i.errors?null:i.errors.required)}}function j(e,p){1&e&&(t.j41(0,"ion-text",6),t.EFF(1," El estado es obligatorio "),t.k0s())}function U(e,p){if(1&e&&(t.j41(0,"div",22),t.DNE(1,j,2,0,"ion-text",23),t.k0s()),2&e){let i;const o=t.XpG();t.R7$(),t.Y8G("ngIf",null==(i=o.eventoForm.get("estado"))||null==i.errors?null:i.errors.required)}}let R=(()=>{var e;class p{constructor(o,n,l,u,v){this.fb=o,this.eventosService=n,this.toastController=l,this.router=u,this.route=v,this.eventoForm=this.fb.group({titulo:["",d.k0.required],descripcion:["",d.k0.required],fechaEvento:["",d.k0.required],horaEvento:["",d.k0.required],lugar:["",d.k0.required],notas:[""],estado:["",d.k0.required]})}ngOnInit(){console.log("ngOnInit en EditarEventoComponent"),this.route.paramMap.subscribe(o=>{const n=Number(o.get("id"));console.log("ID del evento desde la URL:",n),n?this.eventosService.getEvento(n).subscribe({next:l=>{this.evento=l,console.log("Evento cargado exitosamente:",this.evento),this.eventoForm.patchValue(this.evento),console.log("Formulario rellenado con datos del evento.")},error:l=>{console.error("Error al obtener el evento:",l),this.presentToast("Error al cargar el evento","danger"),this.router.navigate(["/eventos/lista"])}}):(console.warn("No se proporcion\xf3 un ID de evento en la URL."),this.presentToast("ID de evento no proporcionado","danger"),this.router.navigate(["/eventos/lista"]))})}onSubmit(){var o=this;return(0,g.A)(function*(){if(o.eventoForm.valid){console.log("Formulario v\xe1lido, enviando cambios...");const n=o.eventoForm.value;let l=n.horaEvento;l&&l.match(/^\d{2}:\d{2}$/)&&(l+=":00");const u={titulo:n.titulo,descripcion:n.descripcion,fechaEvento:n.fechaEvento,horaEvento:l,lugar:n.lugar,notas:n.notas,estado:n.estado,codigoQr:o.evento.codigoQr,directivaRut:o.evento.directivaRut,fechaCreacion:o.evento.fechaCreacion};console.log("Evento a actualizar:",u),o.eventosService.actualizarEvento(o.evento.id,u).subscribe({next:(v=(0,g.A)(function*(){o.presentToast("Evento editado exitosamente","success"),console.log("Evento editado exitosamente, navegando a la lista."),o.router.navigate(o.evento&&o.evento.id?["/eventos/detalle",o.evento.id]:["/eventos"])}),function(){return v.apply(this,arguments)}),error:function(){var v=(0,g.A)(function*(_){console.error("Error al editar el evento:",_),o.presentToast("Error al editar el evento","danger")});return function(f){return v.apply(this,arguments)}}()})}var v})()}presentToast(o,n){var l=this;return(0,g.A)(function*(){(yield l.toastController.create({message:o,duration:2e3,color:n})).present()})()}volverADetalle(){console.log("Bot\xf3n Cancelar presionado."),this.evento&&this.evento.id?(console.log("Navegando al detalle del evento con ID:",this.evento.id),this.router.navigate(["/eventos/detalle",this.evento.id])):(console.warn("No se pudo navegar al detalle del evento: ID de evento no disponible.",this.evento),this.router.navigate(["/eventos/lista"]))}}return(e=p).\u0275fac=function(o){return new(o||e)(t.rXU(d.ok),t.rXU(C.c),t.rXU(r.K_),t.rXU(m.Ix),t.rXU(m.nX))},e.\u0275cmp=t.VBU({type:e,selectors:[["app-editar-evento"]],decls:73,vars:9,consts:[["color","secondary"],["slot","start"],["defaultHref","/eventos"],[1,"ion-padding"],[3,"ngSubmit","formGroup"],["position","stacked"],["color","danger"],["formControlName","titulo","type","text"],["class","error-container",4,"ngIf"],["formControlName","descripcion","rows","3"],["size","6"],["formControlName","fechaEvento","type","date"],["formControlName","horaEvento","type","time"],["formControlName","lugar","type","text"],["formControlName","notas","rows","2"],["formControlName","estado"],["value","activo"],["value","cancelado"],["value","finalizado"],[1,"ion-padding-top"],["expand","block","type","submit"],["expand","block","fill","outline",3,"click"],[1,"error-container"],["color","danger",4,"ngIf"]],template:function(o,n){if(1&o&&(t.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),t.nrm(3,"ion-back-button",2),t.k0s(),t.j41(4,"ion-title"),t.EFF(5,"Editar Evento"),t.k0s()()(),t.j41(6,"ion-content",3)(7,"ion-card")(8,"ion-card-header")(9,"ion-card-title"),t.EFF(10,"Editar Evento"),t.k0s()(),t.j41(11,"ion-card-content")(12,"form",4),t.bIt("ngSubmit",function(){return n.onSubmit()}),t.j41(13,"ion-item")(14,"ion-label",5),t.EFF(15,"T\xedtulo "),t.j41(16,"ion-text",6),t.EFF(17,"*"),t.k0s()(),t.nrm(18,"ion-input",7),t.k0s(),t.DNE(19,O,2,1,"div",8),t.j41(20,"ion-item")(21,"ion-label",5),t.EFF(22,"Descripci\xf3n "),t.j41(23,"ion-text",6),t.EFF(24,"*"),t.k0s()(),t.nrm(25,"ion-textarea",9),t.k0s(),t.DNE(26,c,2,1,"div",8),t.j41(27,"ion-row")(28,"ion-col",10)(29,"ion-item")(30,"ion-label",5),t.EFF(31,"Fecha "),t.j41(32,"ion-text",6),t.EFF(33,"*"),t.k0s()(),t.nrm(34,"ion-input",11),t.k0s(),t.DNE(35,M,2,1,"div",8),t.k0s(),t.j41(36,"ion-col",10)(37,"ion-item")(38,"ion-label",5),t.EFF(39,"Hora "),t.j41(40,"ion-text",6),t.EFF(41,"*"),t.k0s()(),t.nrm(42,"ion-input",12),t.k0s(),t.DNE(43,D,2,1,"div",8),t.k0s()(),t.j41(44,"ion-item")(45,"ion-label",5),t.EFF(46,"Lugar "),t.j41(47,"ion-text",6),t.EFF(48,"*"),t.k0s()(),t.nrm(49,"ion-input",13),t.k0s(),t.DNE(50,T,2,1,"div",8),t.j41(51,"ion-item")(52,"ion-label",5),t.EFF(53,"Notas"),t.k0s(),t.nrm(54,"ion-textarea",14),t.k0s(),t.j41(55,"ion-item")(56,"ion-label",5),t.EFF(57,"Estado "),t.j41(58,"ion-text",6),t.EFF(59,"*"),t.k0s()(),t.j41(60,"ion-select",15)(61,"ion-select-option",16),t.EFF(62,"Activo"),t.k0s(),t.j41(63,"ion-select-option",17),t.EFF(64,"Cancelado"),t.k0s(),t.j41(65,"ion-select-option",18),t.EFF(66,"Finalizado"),t.k0s()()(),t.DNE(67,U,2,1,"div",8),t.j41(68,"div",19)(69,"ion-button",20),t.EFF(70," Guardar Cambios "),t.k0s(),t.j41(71,"ion-button",21),t.bIt("click",function(){return n.volverADetalle()}),t.EFF(72," Cancelar "),t.k0s()()()()()()),2&o){let l,u,v,_,f,b;t.R7$(6),t.xc7("--background","var(--ion-color-light)"),t.R7$(6),t.Y8G("formGroup",n.eventoForm),t.R7$(7),t.Y8G("ngIf",(null==(l=n.eventoForm.get("titulo"))?null:l.touched)&&(null==(l=n.eventoForm.get("titulo"))?null:l.invalid)),t.R7$(7),t.Y8G("ngIf",(null==(u=n.eventoForm.get("descripcion"))?null:u.touched)&&(null==(u=n.eventoForm.get("descripcion"))?null:u.invalid)),t.R7$(9),t.Y8G("ngIf",(null==(v=n.eventoForm.get("fechaEvento"))?null:v.touched)&&(null==(v=n.eventoForm.get("fechaEvento"))?null:v.invalid)),t.R7$(8),t.Y8G("ngIf",(null==(_=n.eventoForm.get("horaEvento"))?null:_.touched)&&(null==(_=n.eventoForm.get("horaEvento"))?null:_.invalid)),t.R7$(7),t.Y8G("ngIf",(null==(f=n.eventoForm.get("lugar"))?null:f.touched)&&(null==(f=n.eventoForm.get("lugar"))?null:f.invalid)),t.R7$(17),t.Y8G("ngIf",(null==(b=n.eventoForm.get("estado"))?null:b.touched)&&(null==(b=n.eventoForm.get("estado"))?null:b.invalid))}},dependencies:[r.bv,r.Jm,r.QW,r.b_,r.I9,r.ME,r.tN,r.hU,r.W9,r.eU,r.$w,r.uz,r.he,r.ln,r.Nm,r.Ip,r.IO,r.nc,r.BC,r.ai,r.Je,r.Gw,r.el,E.MD,E.bT,d.X1,d.qT,d.BC,d.cb,d.j4,d.JD],styles:['@charset "UTF-8";.container[_ngcontent-%COMP%]{padding:2rem;max-width:800px;margin:0 auto}h2[_ngcontent-%COMP%]{margin-bottom:2rem;color:#333}.evento-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.full-width[_ngcontent-%COMP%]{width:100%}.form-row[_ngcontent-%COMP%]{display:flex;gap:1rem}.form-row[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem;margin-top:2rem}mat-form-field[_ngcontent-%COMP%]{margin-bottom:.5rem}textarea[_ngcontent-%COMP%]{min-height:100px}.error-container[_ngcontent-%COMP%]{padding-left:16px;padding-top:5px;font-size:12px}ion-card[_ngcontent-%COMP%]{max-width:600px;margin:0 auto;border-radius:10px;background-color:var(--ion-color-light);box-shadow:0 4px 12px #0000001a}ion-card-title[_ngcontent-%COMP%]{font-size:24px;font-weight:700;color:var(--ion-color-secondary)}.ion-padding-top[_ngcontent-%COMP%]{padding-top:20px}ion-button[_ngcontent-%COMP%]{margin:20px 0;--border-radius: 8px;--background: var(--ion-color-primary);--background-activated: var(--ion-color-primary-shade);--color: white;font-weight:500}a[_ngcontent-%COMP%]{color:var(--ion-color-primary);text-decoration:none;font-weight:500}ion-item[_ngcontent-%COMP%]{--background: var(--ion-color-light);margin-bottom:2px;--border-radius: 8px;--color: #222}ion-input[_ngcontent-%COMP%]{--background: #fff;--padding-start: 10px;--padding-end: 10px;border:1.5px solid #bdbdbd;border-radius:5px;margin-bottom:10px;--color: #222;color:#222!important}ion-label[_ngcontent-%COMP%]{font-size:1.1rem!important;font-weight:700!important;margin-bottom:6px!important;color:#222!important;letter-spacing:.2px}  ion-input,   ion-input input,   ion-input .native-input{color:#222!important;font-weight:500!important}  ion-input::part(native){color:#222!important}  input::placeholder{color:#888!important;opacity:1!important}ion-text[color=danger][_ngcontent-%COMP%]{color:var(--ion-color-danger)!important}p[_ngcontent-%COMP%]{color:var(--ion-color-secondary)}ion-content[_ngcontent-%COMP%]{--color: var(--ion-color-secondary)}ion-textarea[_ngcontent-%COMP%]{--background: #fff;--padding-start: 10px;--padding-end: 10px;border:1.5px solid #bdbdbd;border-radius:5px;margin-bottom:10px;--color: #222;color:#222!important}ion-select[_ngcontent-%COMP%]{width:100%;max-width:100%;margin-top:5px}ion-datetime-button[_ngcontent-%COMP%]{--background: #fff;border:1.5px solid #bdbdbd;border-radius:5px;margin-bottom:10px;--color: #222;color:#222!important;--padding-start: 10px;--padding-end: 10px;height:auto;--padding-top: 10px;--padding-bottom: 10px}ion-datetime-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#222!important}ion-item[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#222!important}']}),p})()},9484:(P,h,s)=>{s.d(h,{c:()=>C});var g=s(7468),d=s(5312),r=s(6354),E=s(1360),t=s(3165);let C=(()=>{var m;class x{constructor(a){this.http=a,this.apiUrl=`${d.c.apiUrl}/api/Eventos`}getEventos(){return this.http.get(this.apiUrl)}getEvento(a){return this.http.get(`${this.apiUrl}/${a}`).pipe((0,r.T)(c=>c.evento))}crearEvento(a){return this.http.post(this.apiUrl,a)}actualizarEvento(a,c){return this.http.put(`${this.apiUrl}/${a}`,c)}eliminarEvento(a){return this.http.post(`${this.apiUrl}/${a}/eliminar`,{})}cancelarEvento(a){return this.http.post(`${this.apiUrl}/${a}/cancelar`,{})}registrarAsistencia(a,c=!1){const F={codigoQr:c?a:null,codigoNumerico:c?null:a};return console.log("Payload enviado al backend:",JSON.stringify(F,null,2)),this.http.post(`${this.apiUrl}/asistencia`,F)}obtenerAsistentes(a){return this.http.get(`${this.apiUrl}/${a}/asistentes`).pipe((0,r.T)(c=>c.asistentes))}obtenerHistorialAsistencia(){return this.http.get(`${this.apiUrl}/historial`)}generarReporteAsistencia(a,c){return this.http.get(`${this.apiUrl}/reporte`,{params:{fechaInicio:a.toISOString(),fechaFin:c.toISOString()}})}generarReporteAsistenciaPorEventoId(a){return(0,g.p)({evento:this.getEvento(a),asistentes:this.obtenerAsistentes(a)}).pipe((0,r.T)(c=>({evento:c.evento,asistentes:c.asistentes,totalAsistentes:c.asistentes.length})))}}return(m=x).\u0275fac=function(a){return new(a||m)(E.KVO(t.Qq))},m.\u0275prov=E.jDH({token:m,factory:m.\u0275fac,providedIn:"root"}),x})()}}]);
"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3379],{3379:(h,m,a)=>{a.r(m),a.d(m,{RegistroAsistenciaComponent:()=>R});var l=a(467),p=a(8434),t=a(3092),E=a(33),A=a(7464);a(9075);const C=(0,A.F3)("BarcodeScanner",{web:()=>a.e(4651).then(a.bind(a,4651)).then(r=>new r.BarcodeScannerWeb)});var f=a(9417),n=a(1360),_=a(9484);function M(r,u){if(1&r){const s=n.RV6();n.j41(0,"div",13)(1,"ion-item")(2,"ion-input",14),n.mxI("ngModelChange",function(o){n.eBV(s);const i=n.XpG();return n.DH7(i.codigoManual,o)||(i.codigoManual=o),n.Njj(o)}),n.bIt("keyup.enter",function(){n.eBV(s);const o=n.XpG();return n.Njj(o.registrarCodigoManual())}),n.k0s()(),n.j41(3,"ion-button",15),n.bIt("click",function(){n.eBV(s);const o=n.XpG();return n.Njj(o.registrarCodigoManual())}),n.EFF(4," Registrar Asistencia "),n.k0s()()}if(2&r){const s=n.XpG();n.R7$(2),n.R50("ngModel",s.codigoManual)}}function b(r,u){if(1&r&&(n.j41(0,"ion-text",16)(1,"p"),n.EFF(2),n.k0s()()),2&r){const s=n.XpG();n.R7$(2),n.JRh(s.mensaje)}}let R=(()=>{var r;class u{constructor(e){this.eventosService=e,this.escaneando=!1,this.mensaje="",this.codigoManual="",this.mostrarInputManual=!1}ngOnInit(){this.solicitarPermisos()}ngOnDestroy(){this.detenerEscaneo()}solicitarPermisos(){var e=this;return(0,l.A)(function*(){try{(yield C.checkPermission({force:!0})).granted||(e.mensaje="Se requieren permisos de c\xe1mara para escanear c\xf3digos QR")}catch(o){console.error("Error al solicitar permisos:",o),e.mensaje="Error al solicitar permisos de c\xe1mara"}})()}iniciarEscaneo(){var e=this;return(0,l.A)(function*(){try{e.escaneando=!0,document.body.style.background="transparent",document.body.style.opacity="0";const o=yield C.startScan();o.hasContent&&(yield e.registrarAsistencia(o.content,!0))}catch(o){console.error("Error al escanear:",o),e.mensaje="Error al escanear el c\xf3digo QR"}finally{e.detenerEscaneo()}})()}detenerEscaneo(){var e=this;return(0,l.A)(function*(){try{yield C.stopScan(),document.body.style.background="",document.body.style.opacity="1",e.escaneando=!1}catch(o){console.error("Error al detener el esc\xe1ner:",o)}})()}toggleInputManual(){this.mostrarInputManual=!this.mostrarInputManual,this.mostrarInputManual&&this.detenerEscaneo()}registrarCodigoManual(){const e=String(this.codigoManual).trim();e&&/^\d+$/.test(e)?(console.log("C\xf3digo a enviar:",e),this.registrarAsistencia(e,!1)):this.mensaje="Por favor, ingrese un c\xf3digo num\xe9rico v\xe1lido"}registrarAsistencia(e,o){var i=this;return(0,l.A)(function*(){if(e&&""!==e.trim())try{const d=String(e).trim();console.log("C\xf3digo formateado para env\xedo:",d),i.eventosService.registrarAsistencia(d,o).subscribe({next:c=>{console.log("Respuesta del servidor:",c),i.mensaje="Asistencia registrada correctamente",i.codigoManual="",i.mostrarInputManual=!1},error:c=>{if(console.error("Error al registrar asistencia:",c),400===c.status){var v;const g=(null===(v=c.error)||void 0===v?void 0:v.mensaje)||"Error al registrar la asistencia";console.log("Detalles del error:",{mensaje:g,codigo:d,error:c.error,payload:c.error}),i.mensaje=g.includes("inactivo")?"El evento est\xe1 inactivo o ha sido cancelado":g.includes("inv\xe1lido")?"El c\xf3digo ingresado no corresponde a ning\xfan evento v\xe1lido":g.includes("Ya existe")?"Ya se ha registrado la asistencia para este evento":g}else i.mensaje=404===c.status?"El c\xf3digo ingresado no corresponde a ning\xfan evento v\xe1lido":409===c.status?"Ya se ha registrado la asistencia para este evento":"Error al registrar la asistencia. Por favor, intente nuevamente"}})}catch(d){console.error("Error al procesar el registro:",d),i.mensaje="Error al procesar el registro. Por favor, intente nuevamente"}else i.mensaje="Por favor, ingrese un c\xf3digo v\xe1lido"})()}}return(r=u).\u0275fac=function(e){return new(e||r)(n.rXU(_.c))},r.\u0275cmp=n.VBU({type:r,selectors:[["app-registro-asistencia"]],decls:27,vars:6,consts:[["color","secondary"],["slot","start"],["defaultHref","/eventos/lista","text",""],["slot","end"],[1,"ion-padding"],[1,"page-title"],[1,"ion-text-center"],["expand","block",3,"click","disabled"],["name","qr-code-outline","slot","start"],["expand","block","fill","outline",1,"ion-margin-top",3,"click"],["name","keypad-outline","slot","start"],["class","ion-margin-top",4,"ngIf"],["color","medium","class","ion-margin-top",4,"ngIf"],[1,"ion-margin-top"],["type","text","placeholder","Ingrese el c\xf3digo del evento",3,"ngModelChange","keyup.enter","ngModel"],["expand","block",1,"ion-margin-top",3,"click"],["color","medium",1,"ion-margin-top"]],template:function(e,o){1&e&&(n.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),n.nrm(3,"ion-back-button",2),n.k0s(),n.j41(4,"ion-title"),n.EFF(5,"VecindApp"),n.k0s(),n.j41(6,"ion-buttons",3),n.nrm(7,"ion-menu-button"),n.k0s()()(),n.j41(8,"ion-content",4)(9,"h1",5),n.EFF(10,"Registrar Asistencia"),n.k0s(),n.j41(11,"ion-card")(12,"ion-card-header")(13,"ion-card-title"),n.EFF(14,"Registro de Asistencia"),n.k0s(),n.j41(15,"ion-card-subtitle"),n.EFF(16,"Escanee el c\xf3digo QR del evento o ingrese el c\xf3digo manualmente"),n.k0s()(),n.j41(17,"ion-card-content")(18,"div",6)(19,"ion-button",7),n.bIt("click",function(){return o.iniciarEscaneo()}),n.nrm(20,"ion-icon",8),n.EFF(21," Iniciar Escaneo "),n.k0s(),n.j41(22,"ion-button",9),n.bIt("click",function(){return o.toggleInputManual()}),n.nrm(23,"ion-icon",10),n.EFF(24),n.k0s(),n.DNE(25,M,5,1,"div",11)(26,b,3,1,"ion-text",12),n.k0s()()()()),2&e&&(n.R7$(8),n.xc7("--background","var(--ion-color-light)"),n.R7$(11),n.Y8G("disabled",o.escaneando),n.R7$(5),n.SpI(" ",o.mostrarInputManual?"Ocultar Ingreso Manual":"Ingresar C\xf3digo Manualmente"," "),n.R7$(),n.Y8G("ngIf",o.mostrarInputManual),n.R7$(),n.Y8G("ngIf",o.mensaje))},dependencies:[p.MD,p.bT,t.bv,t.Jm,t.QW,t.b_,t.I9,t.ME,t.HW,t.tN,t.W9,t.eU,t.iq,t.$w,t.uz,t.MC,t.IO,t.BC,t.ai,t.Gw,t.el,E.iI,f.YN,f.BC,f.vS],styles:["[_nghost-%COMP%]{--card-bg-color: var(--ion-color-light);--text-dark-color: #333333}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: var(--ion-color-secondary);--color: white}ion-title[_ngcontent-%COMP%]{color:#fff!important}.page-title[_ngcontent-%COMP%]{color:var(--ion-color-dark);font-size:1.5em;font-weight:700;margin-bottom:1em;text-align:center}.scanner-container[_ngcontent-%COMP%]{position:relative;width:100%;height:300px;margin:1em 0}.scanner-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;bottom:0;background:transparent;z-index:1000}ion-content[_ngcontent-%COMP%]{--background: var(--ion-color-light);background:var(--ion-color-light)!important;min-height:100vh}[_nghost-%COMP%]     .camera-active{display:none!important}ion-card[_ngcontent-%COMP%]{background:#fff!important;border-radius:14px;box-shadow:0 4px 16px #00000014;margin-bottom:1em}ion-card-title[_ngcontent-%COMP%]{font-weight:700;color:#2c3e50;font-size:1.15em}ion-card-subtitle[_ngcontent-%COMP%]{color:var(--ion-color-medium);font-size:1em}ion-button[_ngcontent-%COMP%]{margin:16px 0 0}"]}),u})()},9075:(h,m,a)=>{a.d(m,{J:()=>t});const t={FRONT:"front",BACK:"back"}}}]);